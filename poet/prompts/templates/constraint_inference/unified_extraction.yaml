name: unified_extraction
description: "Extract all poetry constraints from user input in a single unified analysis"
template: |
  أنت خبير في الشعر العربي والعروض. مهمتك تحليل النص المقدم من المستخدم واستخراج جميع القيود والمتطلبات الشعرية.
  
  النص المطلوب تحليله:
  {user_prompt}
  
  قم بتحليل النص واستخراج المعلومات التالية إذا كانت متوفرة أو يمكن استنتاجها:
  
  1. **القيود العروضية:**
     - البحر الشعري: استخدم الصيغة المناسبة من هذه الأمثلة:
       * "الكامل" أو "بحر الكامل" 
       * "الطويل" أو "بحر الطويل"
       * "البسيط" أو "بحر البسيط"
       * "الوافر" أو "بحر الوافر"
       * "الخفيف" أو "بحر الخفيف"
     - حرف القافية: حرف واحد فقط (ق، ع، ل، م، إلخ)
     - عدد الأبيات
  
  2. **القيود الموضوعية:**
     - الموضوع الرئيسي: استخدم إحدى هذه الصيغ الشائعة:
       * "قصيدة غزل" للغزل
       * "قصيدة هجاء" للهجاء  
       * "قصيدة مدح" للمدح
       * "قصيدة رثاء" للرثاء
       * "قصيدة دينية" للمواضيع الدينية
       * "قصيدة عامه" للمواضيع العامة
     - النبرة العاطفية (حزينة، فرحة، رومانسية، تأملية، إلخ)
     - الصور البلاغية المطلوبة
     - الكلمات المفتاحية
  
  3. **القيود الأسلوبية:**
     - مستوى اللغة: استخدم "فصيح" أو "فصحى" للغة الفصيحة، "عامي" للعامية
     - العصر (كلاسيكي، حديث)
     - أسلوب شاعر معين
  
  4. **القيود الهيكلية:**
     - أقسام القصيدة (مقدمة، غزل، تخلص، إلخ)
     - التطور الموضوعي
  
  **تعليمات مهمة:**
  - للبحور: فضل الصيغة بدون "بحر" إذا لم تكن محددة (مثل "الكامل" بدلاً من "بحر الكامل")
  - للمواضيع: استخدم دائماً صيغة "قصيدة + الموضوع" (مثل "قصيدة غزل" وليس "غزل" فقط)
  - للغة: استخدم "فصيح" كخيار أول للشعر الكلاسيكي
  - إذا لم تكن المعلومة واضحة، اقترح البديل الأنسب مع ذكر السبب
  - إذا كانت هناك غموض، اطلب التوضيح من المستخدم
  - إذا كانت المعلومة مفقودة، اتركها فارغة أو اقترح قيمة افتراضية مناسبة
  
  أجب بالتنسيق التالي بدقة:
  ```json
  {{
    "meter": "البحر المستخرج أو null",
    "rhyme": "حرف القافية أو null",
    "line_count": عدد_الأبيات_أو_null,
    "theme": "الموضوع الرئيسي أو null",
    "tone": "النبرة العاطفية أو null",
    "imagery": ["قائمة", "الصور", "البلاغية"],
    "keywords": ["الكلمات", "المفتاحية"],
    "register": "مستوى اللغة أو null",
    "era": "العصر أو null", 
    "poet_style": "أسلوب الشاعر أو null",
    "sections": ["أقسام", "القصيدة"],
    "ambiguities": ["قائمة", "الغموض", "والتوضيحات المطلوبة"],
    "suggestions": "اقتراحات للمستخدم أو null",
    "reasoning": "شرح موجز لاختياراتك"
  }}
  ```
category: constraint_inference
parameters:
  - user_prompt
metadata:
  version: "1.1"
  language: "arabic"
  complexity: "high" 