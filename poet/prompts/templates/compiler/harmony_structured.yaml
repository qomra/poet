name: "harmony_structured"
description: "Generate structured Harmony data compatible with openai_harmony library"
category: "compiler"
parameters:
  - user_prompt
  - initial_constraints
  - execution_steps
  - final_poem
  - quality_assessment
  - conversation_start_date
  - cursor
  - toolname
  - line_start
  - line_end
  - name
  - output
  - id
  - long_chain_of_thought

template: |
  أنت خبير في تحليل عمليات توليد الشعر العربي وتحتاج إلى إعادة بناء عملية التفكير بتنسيق OpenAI Harmony.
  
  CRITICAL: أنت تحاكي وكيل ذكي يقوم بتحليل عملية توليد الشعر العربي.
  ليس لديك إمكانية الوصول إلى أي أدوات - فقط قم بتحليل البيانات المدخلة والمخرجات.
  
  # تعليمات خاصة بمعالجة خطوات الأنبوب
  
  ## تحليل خطوات التنفيذ
  لكل خطوة في execution_steps، قم بإنشاء تفكير طبيعي يوضح:
  - ما تم تحليله من قيود ومتطلبات
  - القرارات التي تم اتخاذها وسببها
  - ربط كل خطوة منطقياً بالخطوة التالية
  - التأمل في الجودة والمشاكل الموجودة
  - شرح قرارات التحسين
  
  ## أنواع الخطوات المتوقعة
  
  ### select_qafiya: تحليل القافية
  - قم بتحليل القيود المدخلة (qafiya, qafiya_harakah, qafiya_type, إلخ)
  - افحص المخرجات النهائية لمعرفة ما تم اختياره
  - اكتب تفكيراً طبيعياً يوضح كيف تم تحليل القافية المطلوبة واختيار النمط المناسب
  
  ### select_bahar: تحليل البحر  
  - قم بتحليل القيود المدخلة (meter, meeter_tafeelat)
  - افحص المخرجات النهائية لمعرفة ما تم اختياره
  - اكتب تفكيراً طبيعياً يوضح كيف تم تحديد البحر والتفعيلات
  
  ### refiner calls: تحليل التحسين
  - افحص المدخلات والمخرجات بعناية
  - اكتب تفكيراً طبيعياً يوضح كيف تم اختيار الأبيات المحددة للتحسين
  - اكتب تفكيراً طبيعياً حول عملية التحسين والتحقق من الجودة
  - تأكد من أن اختيار الأبيات يتطابق تماماً مع البيانات المدخلة
  
  ### evaluate_poem: تقييم القصيدة
  - افحص نتائج التقييم النهائية
  - اكتب تفكيراً طبيعياً حول جودة القصيدة والمشاكل الموجودة
  - ربط التقييم بالقيود الأصلية

  # بيانات التنفيذ
  
  النص المطلوب من المستخدم: {user_prompt}
  القيود الأولية: {initial_constraints}
  
  # خطوات الأنبوب المنفذة
  
  {execution_steps}
  
  # المخرجات النهائية
  القصيدة النهائية: {final_poem}
  تقييم الجودة: {quality_assessment}
  
  # المهمة
  
  قم بتوليد محادثة Harmony كاملة تظهر عملية توليد الشعر كما لو أن الذكاء الاصطناعي
  يفكر في كل خطوة. يتضمن:
  
  1. رسالة نظام بمستوى تفكير "عالي" وتعريف أداة المتصفح
  2. رسالة مطور بتعليمات توليد الشعر (استخدم أداة المتصفح للبحث على الويب فقط، لا تستخدم الأدوات الداخلية)
  3. رسالة مستخدم بالنص المطلوب والقيود
  4. رسائل مساعد تظهر:
     - التفكير المتسلسل في رسائل <|channel|>analysis
     - المخرجات النهائية في رسائل <|channel|>final
  
  لكل خطوة في الأنبوب، قم بإنشاء تفكير طبيعي يوضح:
  - ما يفكر فيه الذكاء الاصطناعي (استخدم <|channel|>analysis للتفكير المتسلسل)
  - لماذا تم اتخاذ قرارات معينة
  - ربط كل خطوة منطقياً بالخطوة التالية
  - التأمل في الجودة والمشاكل الموجودة
  - شرح قرارات التحسين
  
  # القيود المهمة
  
  - لا تستخدم أي أدوات - ركز على التحليل والتفكير فقط
  - لا تستخدم أدوات توليد الشعر الداخلية مثل QafiyaSelector أو RefinerChain أو PoemEvaluator
  - يجب أن يكون كل التفكير والتحليل في قناة analysis
  - يجب أن تكون المخرجات النهائية في قناة final
  - يجب أن يشعر التفكير بأنه عملية تفكير متماسكة، وليس مجرد قائمة ميكانيكية من الخطوات
  
  # تعليمات القنوات
  - قناة analysis: للتفكير والتحليل المتسلسل حول كل خطوة في الأنبوب
  - قناة final: للمخرجات النهائية (القصيدة وتقييم الجودة)
  - لا تستخدم قناة commentary في هذه المرحلة
  
  ابدأ ردك بـ:
  <|start|>system<|message|>أنت وكيل توليد الشعر العربي.
  Knowledge cutoff: 2024-06
  Current date: {conversation_start_date}
  Reasoning: high
  # Valid channels: analysis, final. Channel must be included for every message.<|end|>

  ثم أضف رسالة المستخدم:
  <|start|>user<|channel|>analysis<|message|>أريد توليد شعر عربي<|end|>

  ثم أضف رسائل المساعد مع القنوات المناسبة:
  <|start|>assistant<|channel|>analysis<|message|>سأقوم بتحليل متطلباتك...<|end|>
  <|start|>assistant<|channel|>final<|message|>هنا القصيدة النهائية...<|end|> 